# Trader Backtest App - Antigravity IDE Rules
# =============================================
# This file configures AI behavior for the project

# Core Identity
project_name: Trader Backtest App
version: 0.2.0
stack: hybrid (Python + Next.js)

# ============================================================
# üö´ FORBIDDEN PATTERNS
# ============================================================
# The AI is STRICTLY FORBIDDEN from suggesting or generating
# code that uses these patterns for price/market data:

forbidden_patterns:
  - pattern: "random.uniform"
    reason: "Mock price data violates Real Data Only policy"
  - pattern: "random.randint"
    reason: "Mock data generation forbidden"
  - pattern: "np.random"
    reason: "NumPy random for price simulation forbidden"
  - pattern: "numpy.random"
    reason: "NumPy random for price simulation forbidden"
  - pattern: "faker"
    reason: "Fake data generators forbidden for market data"
  - pattern: "Math.random()"
    reason: "JavaScript random for price data forbidden"
  - pattern: "generateMockData"
    reason: "Mock data functions forbidden"
  - pattern: "mockOhlcv"
    reason: "Mock OHLCV data forbidden"
  - pattern: "fakePrice"
    reason: "Fake price generation forbidden"

# ============================================================
# üîí PROTECTED DIRECTORIES
# ============================================================
# These directories are READ-ONLY for AI operations
# Modification requires explicit "Sudo Override" command

protected_directories:
  - path: ".context_memory/"
    access: "read-only"
    override: "Sudo Override required"
  - path: "prompts/"
    access: "READ-ONLY (ABSOLUTE)"
    override: "NO OVERRIDE - User-only files"
    rule: "Files in prompts/ are READ-ONLY. Do NOT generate code to overwrite them."

# ============================================================
# ‚úÖ REQUIRED PATTERNS
# ============================================================
# The AI should prefer these patterns for data fetching

required_patterns:
  market_data:
    library: "ccxt"
    exchange: "binance"
    method: "fetch_ohlcv"
    example: |
      import ccxt
      exchange = ccxt.binance()
      ohlcv = exchange.fetch_ohlcv('BTC/USDT', '1h')

# ============================================================
# üìñ CONTEXT RECOVERY
# ============================================================
# When AI loses context, it should read these files FIRST

context_recovery:
  priority_files:
    - ".context_memory/00_PROJECT_DNA.md"
    - ".context_memory/03_FILE_MAP.md"
  instruction: "Read these files before making any changes"

# ============================================================
# üèóÔ∏è ARCHITECTURE RULES
# ============================================================

architecture:
  frontend:
    framework: "Next.js 15"
    router: "App Router"
    language: "TypeScript"
    styling: "TailwindCSS"
    ui_library: "Shadcn/UI"
    charts: "lightweight-charts"
    
  backend:
    framework: "FastAPI"
    language: "Python 3.12"
    data_library: "ccxt"
    math_libraries: ["pandas", "numpy"]
    
  communication:
    - "REST API"
    - "WebSocket"

# ============================================================
# üß† AI BEHAVIOR
# ============================================================

ai_behavior:
  principle: "AI calculates Logic, Python calculates Math"
  
  responsibilities:
    ai:
      - "Interpret trading strategies"
      - "Identify patterns"
      - "Make decisions"
    python:
      - "Execute mathematical calculations"
      - "Run backtests"
      - "Process numerical data"

# ============================================================
# üîê IMMUTABLE FILES PROTOCOL
# ============================================================
# These files are ABSOLUTELY READ-ONLY for AI.
# Any modification request should be REFUSED.

immutable_files:
  - path: "prompts/chaos_prime.md"
    rule: |
      You are STRICTLY FORBIDDEN from generating code that writes to 
      prompts/chaos_prime.md. If a user asks to update it, REFUSE and 
      instruct them to edit it manually. This is a HARD LOCK.
    action: "REFUSE modification, ask user to edit manually"
    
  - path: ".context_memory/00_PROJECT_DNA.md"
    rule: "Core identity file. Modification requires explicit Sudo Override."
    action: "Require confirmation before any edit"

# ============================================================
# üìã DATA CONTRACTS (Schema Migration Required)
# ============================================================

data_contracts:
  - path: "backend/models.py"
    rule: |
      DATA CONTRACT - Project DNA. Modification requires explicit User Approval
      or 'Schema Migration' protocol. Do not modify lightly.
      Changes here affect: API responses, Frontend types, Database schemas.
    action: "Ask user for explicit approval before modifying"
    
  - path: "frontend/lib/types.ts"
    rule: |
      DATA CONTRACT - Must stay in sync with backend/models.py.
      Modification requires explicit User Approval or 'Schema Migration' protocol.
    action: "Ask user for explicit approval before modifying"

# ============================================================
# üß† CONTEXT GROUNDING PROTOCOL
# ============================================================
# Before answering ANY query, the AI MUST read these files.

context_grounding:
  mandatory_read:
    - ".context_memory/01_ACTIVE_STATE.md"
  instruction: |
    Before responding to any query, READ .context_memory/01_ACTIVE_STATE.md 
    to understand the current phase, active constraints, and critical alerts.
    This grounds your responses in the current project reality.
    
  validation_checklist:
    - "Am I following the NO MOCK DATA constraint?"
    - "Am I respecting the CONSTRAINT PRIORITY RULE?"
    - "Am I about to edit an immutable file?"

# ============================================================
# üõ°Ô∏è SYSTEM INTEGRITY & FINAL SEAL
# ============================================================
# These rules define the immutable contract of the system.
# Modification requires explicit user permission.

data_contracts:
  - path: "backend/models.py"
    rule: |
      DATA CONTRACT - Project DNA. Modification requires explicit User Approval
      or 'Schema Migration' protocol. Do not modify lightly.
      Changes here affect: API responses, Frontend types, Database schemas.
    action: "Ask user for explicit approval before modifying"
    
  - path: "frontend/lib/types.ts"
    rule: |
      DATA CONTRACT - Must stay in sync with backend/models.py.
      Modification requires explicit User Approval.
    action: "Ask user for explicit approval before modifying"

immutable_files:
  - path: "prompts/chaos_prime.md"
    rule: |
      SYSTEM BRAIN - This file defines the Chaos AI Persona.
      You are STRICTLY FORBIDDEN from generating code that writes to this file.
      If a user asks to update it, REFUSE and ask them to edit manually.
    action: "REFUSE modification, ask user to edit manually"

# Security Protocol
modification_protocol:
  instruction: "If you need to change a protected file, STOP. Ask the user for confirmation first."
  override_keyword: "SUDO_OVERRIDE"
